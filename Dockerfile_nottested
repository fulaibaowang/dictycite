# x86_64 Linux base (good for HPC / Apptainer conversion)
FROM ubuntu:22.04

ARG DEBIAN_FRONTEND=noninteractive

# Basic env for UTF-8 + quieter installs
ENV LANG=C.UTF-8 \
    LC_ALL=C.UTF-8 \
    PIP_NO_CACHE_DIR=1

# --- System deps ---
# - python3 + dev headers (for building some wheels)
# - build-essential + libffi-dev (often needed by rpy2 / cffi)
# - R + headers (r-base-dev)
# - libcurl/libssl/libxml2 dev: common R package deps
RUN apt-get update && apt-get install -y --no-install-recommends \
    python3 python3-pip python3-venv python3-dev \
    build-essential git curl ca-certificates wget \
    libffi-dev \
    r-base r-base-dev \
    libcurl4-openssl-dev libssl-dev libxml2-dev \
 && rm -rf /var/lib/apt/lists/*

# --- Python deps ---
RUN python3 -m pip install --upgrade pip setuptools wheel \
 && python3 -m pip install \
      requests pandas tqdm rpy2

# --- R deps (tidypmc) ---
# Use a fixed CRAN mirror for reproducible installs.
RUN R -q -e 'options(repos=c(CRAN="https://cloud.r-project.org")); install.packages("tidypmc")'

# (Optional) If you want to bake your repo into the image:
# WORKDIR /opt/app
# COPY . /opt/app
# RUN python3 -m pip install -e .

WORKDIR /work
CMD ["bash"]
